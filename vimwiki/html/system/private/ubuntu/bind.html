<!DOCTYPE HTML>
<html>
    <head>
        <!-- SyntaxHighlighter -->
        <script src="../../../../public/sh/scripts/shCore.js"></script>
        <script src="../../../../public/sh/scripts/shBrushAll.js"></script>
        <link type="text/css" rel="stylesheet" href="../../../../public/sh/styles/shCore.css"/>
        <link type="text/css" rel="stylesheet" href="../../../../public/sh/styles/shThemeMidnight.css"/>
        <script>
                SyntaxHighlighter.config.clipboardSwf = '../../../../public/sh/scripts/clipboard.swf';
                    SyntaxHighlighter.all();
        </script>
                <!-- 第一行是引入核心文件 -->
                <!-- 第二行是引入语法高亮文件（可视需要书写多条，具体可查看 scripts 文件夹下的各个文件） -->
                <!-- 更多语法高亮请访问 https://github.com/ruchee/backup2/tree/master/scripts 获取 -->
                <!-- 第三行是引入基本 CSS 文件 -->
                <!-- 第四行是指定使用的颜色主题（更多主题可查看 styles 文件夹） -->
                <!-- ../../../ 指代的是 HTML 代码根目录 -->
        <title>Bind9的安装与配置</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <link rel="Stylesheet" type="text/css" href="../../../../public/css/main.css" />
        <!-- blog ico -->
        <link type="image/x-icon" rel="icon" href="../../../../public/images/ruchee.ico" />
        <link type="image/x-icon" rel="shortcut icon" href="../../../../public/images/ruchee.ico" />
    </head>
    <body>
        <center style="font-family: 'Microsoft Yahei', sans-serif; font-size: 1.80em;
            font-weight: normal; color: #FF6600">Mdaxue-Wiki</center><br />
        <center>MdaxueWiki系统</center>


        
<h2 id="toc_0.1">Bind9的安装与配置</h2>
<p>
这里主要介绍的是在个人开发环境中涉及到本地、测试、生产这三个环境下关于*.mdaxue.com切换问题的解决方案。
</p>

<p>
因为这里设计到多个域名的管理，所以必须用到DNS服务器，然后涉及到不同环境下的DNS解析与切换，这里就需要一个脚本来管理。
</p>

<p>
因为是做Web开发所以还涉及到浏览器对网页DNS解析缓存的问题。
</p>

<p>
最终要解决的问题就是：可以很方便的在这三个环境中切换，访问不同ip上的项目，并能在浏览器中实时看到最新的效果。
</p>

<hr />
<h3 id="toc_0.1.1">Bind9的安装与配置</h3>
<ol>
<li>
<code>安装</code>：这里的Dns服务器选择的是bind,安装很简单<code>apt-get install bind9</code>即可搞定。

<li>
<code>配置</code>:

<ol>
<li>
关闭<code>NetworkManager</code>，防止<code>NetworkManager</code>每次都会重写下一步中的DNS解析服务配置。<code>sudo service network-manager stop</code>,并且要查看是否开机自动启动，如果有需要关闭，具体如何详细关闭<code>NetworkManager</code>可以google。

<li>
修改<code>/etc/resolv.conf</code>，添加<code>nameserver 127.0.0.1</code>到首行。

<li>
为了减少配置的麻烦性，我直接将所有的bind配置文件都打包到概览里面约定的<code>Packages/etc/bind-conf.tar.gz</code>中了，安装好bind后直接解压到<code>/etc/bind/</code>目录进行覆盖,然后<code>service bind9 reload</code>即可。

</ol>
</ol>
<hr />
<h3 id="toc_0.1.2">不同环境下的DNS解析与切换</h3>
<ol>
<li>
因为存在本地、测试、生产这三个环境，每一个环境下*.mdaxue.com对应的ip地址都可能不一样。为了方便这三个环境的切换而写了一个简单的脚本，放在<code>Packages/etc/switchdns</code>中

<li>
将该文件放到<code>/etc/init.d/switchdns</code>中，添加执行权限<code>chmod a+x /etc/init.d/switchdns</code>

<li>
使用方法可以直接执行<code>sudo service swithcdns</code>,会回显<code>Usage:switchdns local|test|online|status</code>，这里<code>local</code>代表本地,<code>test</code>代表测试服务器,<code>online代表生产环境</code>,<code>status</code>查看当前是什么环境。

<li>
上述参数，即环境对应的bind解析DNS文件分别是:

<ul>
<li>
<code>local</code>-&gt;<code>/etc/bind/db.local</code>

<li>
<code>test</code>-&gt;<code>/etc/bind/db.test</code>

<li>
<code>online</code>-&gt;<code>/etc/bind/db.mdaxue.com</code>

</ul>
</ol>
<p>
你可以在相应环境下，在对应文件里面配置对应域名的ip解析，然后<code>sudo service switchdns local</code>切换到对应环境，这里演示的是<code>local</code>
<hr />
</p>
<h3 id="toc_0.1.3">关于浏览器缓存的问题</h3>
<p>
因为我们可能随时都会切换环境，这样会导致我们在终端可能已经配置解析好了，ping的时候也发现ip指向的是正确的ip，但是浏览器却访问的不是正确的服务器，这是由于浏览器有DNS缓存机制导致的。我们可以安装<code>DNS Cache</code>解决这个问题。这是一个火狐插件，chrome下大家可以找类似的插件。
<hr />
</p>



        <center  style="font-family: 'Microsoft Yahei'; font-size: small; font-weight: normal; color: #009933">
            Mdaxue&nbsp;&copy;&nbsp;2011-2013&nbsp;www.mdaxue.com<br/>
            Generated by Vim and Vimwiki
        </center>
    </body>
</html>
